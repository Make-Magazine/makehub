var templateUrl,AUTH0_CLIENT_ID="NDw7r6YLomyGceVgG7PIt2wIhIgLNqxG",AUTH0_CUSTOM_DOMAIN="login.make.co",AUTH0_DOMAIN="makermedia.auth0.com",AUTH0_CALLBACK_URL=templateUrl=void 0===templateUrl?window.location.origin:templateUrl,AUTH0_REDIRECT_URL=location.href,auth0Hash=window.location.hash||localStorage.getItem("auth0_hash");-1<window.location.hash.indexOf("access_token")&&(localStorage.setItem("auth0_hash",auth0Hash),localStorage.setItem("first_login","true")),jQuery(document).ready(function(){var o,a,e=new URL(location.href).hostname,t=!1,n=!1,r=!1,i=!1;function s(){a.checkSession({},function(e,a){e?("login_required"!==e.error&&y("User had an issue logging in at the checkSession phase. That error was: "+JSON.stringify(e)),r&&jQuery("body").is(".logged-in")&&g(),l()):(t=!0,o=a.idTokenPayload,u(a),r&&0==n&&!jQuery("body").is(".logged-in")&&(jQuery(".universal-footer").before('<img src="https://make.co/wp-content/universal-assets/v1/images/makey-spinner.gif" class="universal-loading-spinner" style="position:absolute;top:50%;left:50%;margin-top:-75px;margin-left:-75px;" />'),p())),c()})}function l(){localStorage.removeItem("auth0_hash"),localStorage.removeItem("access_token"),localStorage.removeItem("id_token"),localStorage.removeItem("expires_at")}function u(e){var a;e?(a=JSON.stringify(36e4*e.expiresIn+(new Date).getTime()),localStorage.setItem("access_token",e.accessToken),localStorage.setItem("id_token",e.idToken),localStorage.setItem("expires_at",a)):l()}function c(){t||n?(jQuery("#profile-view, #LogoutBtn").css("display","flex"),jQuery("#mzLoginBtn").css("display","none"),jQuery(".login-section #dropdownMenuLink .avatar").css("display","block"),function(){var e={};if(n&&i)e={user_avatar:null==ajax_object.wp_user_avatar?"":ajax_object.wp_user_avatar,user_email:null==ajax_object.wp_user_email?"":ajax_object.wp_user_email,user_name:null==ajax_object.wp_user_nicename?"":ajax_object.wp_user_nicename,user_memlevel:null==ajax_object.wp_user_memlevel?"":ajax_object.wp_user_memlevel};else{if(!t)return;localStorage.getItem("access_token")||y("Login attempted without Access Token"),e={user_avatar:null==o["http://makershare.com/picture"]?o.picture:o["http://makershare.com/picture"],user_email:null==o.email?"":o.email,user_name:null==o["http://makershare.com/first_name"]&&null==o["http://makershare.com/last_name"]?"":o["http://makershare.com/first_name"]+" "+o["http://makershare.com/last_name"],user_memlevel:null==o["http://makershare.com/membership_level"]?"":o["http://makershare.com/membership_level"]}}(function(e){if(""!=e.user_avatar&&(jQuery("#profile-view #dropdownMenuLink img.avatar").attr("src",e.user_avatar),jQuery("#profile-view .profile-info img.avatar").attr("src",e.user_avatar)),document.querySelector(".profile-email").innerHTML=e.user_email,document.querySelector(".profile-info .profile-name").innerHTML=e.user_name,""!=e.user_memlevel)switch(e.user_memlevel){case"premium":document.querySelector(".avatar-banner").src="https://make.co/wp-content/universal-assets/v1/images/premium-banner.png",document.querySelector(".avatar-banner").setAttribute("alt","Premium Member");break;case"upgrade":document.querySelector(".avatar-banner").src="https://make.co/wp-content/universal-assets/v1/images/upgrade-banner.png",document.querySelector(".avatar-banner").setAttribute("alt","Upgrade Membership")}else jQuery(".avatar-banner").remove();setTimeout(function(){document.querySelector(".avatar-banner").style.display="block"},100),document.querySelector("#LoginBtn").style.display="none",document.querySelector(".dropdown-toggle img").style.display="block",jQuery(".login-section").css("display","block")})(e),jQuery(".profile-menu").addClass("logged-in"),jQuery(".mobile-subscribe-btn").css("display","none"),"upgrade"==e.user_memlevel?jQuery(".dropdown-menu .profile-info").after("<a href='https://make.co/join/' class='btn membership-btn'>Upgrade Membership</a>"):"none"==e.user_memlevel&&jQuery(".dropdown-menu .profile-info").after("<a href='https://make.co/join/' class='btn membership-btn'>Join Now!</a>"),function(a){jQuery.ajax({type:"POST",url:"https://devapi.rimark.io/api/auth/local/",data:'{"identifier": "webmaster@make.co","password":"AHxv2sj3hK*rWpF"}',contentType:"application/json; charset=utf-8",success:function(e){e=e.jwt;jQuery.ajax({type:"GET",url:"https://devapi.rimark.io/api/makes?filters[user_email][$eq]="+a.user_email,headers:{Authorization:"Bearer "+e},contentType:"application/json; charset=utf-8",success:function(e){coins=jQuery.isEmptyObject(e.data)||""==e.data[0].attributes.total_supply_owned?'$MAKE:<br/><a target="_blank" href="https://make.co/make-faq/">Learn More</a>':'$MAKE:<br/><a target="_blank" href="https://beta.rimark.io/?target=219f76ovo2v0fi2nn9es0x9wf">'+e.data[0].attributes.total_supply_owned+"</a>",jQuery("#make-coin").html(coins)}})}})}(e),jQuery("body").is(".buddyboss-theme")&&(d(),m())}()):(jQuery("#LoginBtn").css("display","block"),jQuery("#profile-view, #LogoutBtn").css("display","none"),jQuery(".login-section").css("display","block"),m(),d())}function m(){document.body.classList.contains("bb-buddypanel")&&(0==n?jQuery("body").addClass("buddypanel-open"):jQuery("body").addClass("buddypanel-closed"),jQuery("body").hasClass("bb-page-loaded")||jQuery("body").addClass("bb-page-loaded"),window.dispatchEvent(new Event("resize")))}function d(){jQuery(".buddypanel .side-panel-inner img").remove(),jQuery(".buddypanel .side-panel-inner #buddypanel-menu").css("display","block")}function p(){var e,a;void 0!==o&&(o.sub,e=localStorage.getItem("access_token"),a=localStorage.getItem("id_token"),a={action:"mm_wplogin",auth0_userProfile:o,auth0_access_token:e,auth0_id_token:a},jQuery.ajax({type:"POST",url:ajax_object.ajax_url,data:a,timeout:1e4,success:function(e){}}).done(function(){0==n&&(jQuery("#menu-secondary_universal_menu").load(document.URL+" #menu-secondary_universal_menu > *"),jQuery(".main-content").length&&jQuery(".join-box").length&&window.location.replace("/digital-library/"),!jQuery(".main-content").length||jQuery(".blog.tribe-theme-child-make-campus").length||jQuery(".makerspaces").length||jQuery(".post-type-archive-tribe_events ").length||jQuery(".main-content").load(document.URL+" .main-content > *"),jQuery(".page-content").length&&jQuery(".page-content").load(document.URL+" .page-content > *"),jQuery(".logged-in-refresh").length&&jQuery(".logged-in-refresh").load(document.URL+" .logged-in-refresh > *"),jQuery("#buddypanel-menu .bp-login-nav").length?(jQuery("#buddypanel-menu").load(document.URL+" #buddypanel-menu > *",function(){d()}),jQuery("body").addClass("buddypanel-closed")):jQuery("#buddypanel-menu .bp-logout-nav").length&&d(),jQuery("body").addClass("logged-in"),jQuery(".universal-loading-spinner").remove()),m()}).fail(function(e,a,t){jQuery(".universal-loading-spinner").remove(),"timeout"===a?(alert("Your login has timed out. Please try the login again."),y(o.email+" ran over the timeout limit of 10 seconds. Error was: "+JSON.stringify(t)),location.href=location.href):(alert("I'm sorry. We had an issue logging you into our system. Error Code: 0599.\nPlease contact our support at community@make.co with this error code for assistance."),y(o.email+" had an issue logging in at the WP Login phase. That error is: "+JSON.stringify(e)))}))}function g(){jQuery("#wpadminbar").length&&(jQuery("body").removeClass("adminBar").removeClass("logged-in"),jQuery("#wpadminbar").remove(),jQuery("#mm-preview-settings-bar").remove());jQuery.post(ajax_object.ajax_url,{action:"mm_wplogout"},function(e){window.location.href="https://login.make.co/v2/logout?returnTo="+templateUrl+"&client_id="+AUTH0_CLIENT_ID}).done(function(){l(),location.href=location.href}),m()}function y(e){e={action:"make_error_log",make_error:e};jQuery.post(ajax_object.ajax_url,e,function(e){})}-1!==e.indexOf("make.co")||-1!==e.indexOf("makehub")?r=i=!0:-1===e.indexOf("mfaire")&&-1===e.indexOf("makerfaire")||(r=!0),i&&(document.body.classList.contains("logged-in")||"true"==getUrlParam("login"))?(n=!0,c()):(jQuery(".buddypanel").length&&(jQuery(".buddypanel .side-panel-inner").prepend("<img src='https://make.co/wp-content/universal-assets/v1/images/makey-spinner.gif' height='50px' width='50px' style='margin:auto;' />"),jQuery(".buddypanel .side-panel-inner #buddypanel-menu").css("display","none")),a=new auth0.WebAuth({domain:AUTH0_CUSTOM_DOMAIN,clientID:AUTH0_CLIENT_ID,redirectUri:AUTH0_CALLBACK_URL,audience:"https://"+AUTH0_DOMAIN+"/userinfo",responseType:"token id_token",scope:"openid profile email user_metadata",leeway:60}),jQuery("#LogoutBtn").on("click",function(e){l()}),0==r&&(jQuery("#LoginBtn").on("click",function(e){e.preventDefault(),setCookie("mz_redirect_url",window.location.href,1),a.authorize({clientID:AUTH0_CLIENT_ID,redirect_uri:location.protocol+"//"+location.hostname})}),jQuery("#LogoutBtn").on("click",function(e){e.preventDefault(),a.logout({clientID:AUTH0_CLIENT_ID,returnTo:location.protocol+"//"+location.hostname})})),localStorage.getItem("first_login")?(auth0Hash.includes("access_token")?a.parseHash({hash:auth0Hash},function(e,a){e&&console.log("parse hash err",e),a&&(t=!0,o=a.idTokenPayload,u(a),c(),r&&0==n&&!jQuery("body").is(".logged-in")&&(jQuery(".universal-footer").before('<img src="https://make.co/wp-content/universal-assets/v1/images/makey-spinner.gif" class="universal-loading-spinner" style="position:absolute;top:50%;left:50%;margin-top:-75px;margin-left:-75px;" />'),p())),window.location.hash=""}):auth0Hash.includes("login_required")&&(r&&jQuery("body").is(".logged-in")&&g(),l()),localStorage.removeItem("first_login")):localStorage.getItem("expires_at")&&localStorage.getItem("expires_at")>Date.now()?a.client.userInfo(localStorage.getItem("access_token"),function(e,a){e&&"https://make.co/wp-content/universal-assets/v1/images/default-makey.png"==jQuery("#profile-view img.avatar").attr("src")&&(console.log(e),s()),o=a,t=!0,c()}):s())});
//# sourceMappingURL=universal-auth0.min.js.map