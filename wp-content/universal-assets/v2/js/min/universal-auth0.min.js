var templateUrl,AUTH0_CLIENT_ID="NDw7r6YLomyGceVgG7PIt2wIhIgLNqxG",AUTH0_CUSTOM_DOMAIN="login.make.co",AUTH0_DOMAIN="makermedia.auth0.com",AUTH0_CALLBACK_URL=templateUrl=void 0===templateUrl?window.location.origin:templateUrl,AUTH0_REDIRECT_URL=location.href,auth0Hash=window.location.hash||localStorage.getItem("auth0_hash");function getCookie(e){for(var o=e+"=",t=document.cookie.split(";"),a=0;a<t.length;a++){for(var r=t[a];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(o))return r.substring(o.length,r.length)}return null}function delete_cookie(e){document.cookie=e+"=; expires=Tue, 16 Oct 1979 00:00:01 GMT;path=/"}-1<window.location.hash.indexOf("access_token")&&(localStorage.setItem("auth0_hash",auth0Hash),localStorage.setItem("first_login","true")),"/"==window.location.pathname&&getCookie("make_redirect_url")&&(window.location.replace(getCookie("make_redirect_url")),delete_cookie("make_redirect_url")),jQuery(document).ready(function(){var a,o,e=new URL(location.href).hostname,t=!1,r=!1,n=!1,i=!1;function s(){!navigator.userAgent.includes("Safari")&&!/iPad|iPhone|iPod/.test(navigator.userAgent)||-1===e.indexOf("mfaire")&&-1===e.indexOf("makerfaire")?o.checkSession({},function(e,o){e?("login_required"!==e.error&&g("User had an issue logging in at the checkSession phase. That error was: "+JSON.stringify(e)),n&&jQuery("body").is(".logged-in")&&d(),l()):(t=!0,a=o.idTokenPayload,c(o),n&&0==r&&!jQuery("body").is(".logged-in")&&(jQuery(".universal-footer").before('<img src="https://make.co/wp-content/universal-assets/v2/images/makey-spinner.gif" class="universal-loading-spinner" style="position:absolute;top:50%;left:50%;margin-top:-75px;margin-left:-75px;" />'),m())),u()}):(jQuery("body").is(".logged-in")&&(r=!0),u())}function l(){localStorage.removeItem("auth0_hash"),localStorage.removeItem("access_token"),localStorage.removeItem("id_token"),localStorage.removeItem("expires_at")}function c(e){var o;e?(o=JSON.stringify(36e4*e.expiresIn+(new Date).getTime()),localStorage.setItem("access_token",e.accessToken),localStorage.setItem("id_token",e.idToken),localStorage.setItem("expires_at",o)):l()}function u(){if(t||r){jQuery("#profile-view, #LogoutBtn").css("display","flex"),jQuery("#mzLoginBtn").css("display","none"),jQuery(".login-section #dropdownMenuLink .avatar").css("display","block");var e={};if(r)e={user_avatar:void 0===ajax_object.wp_user_avatar?"":ajax_object.wp_user_avatar,user_email:void 0===ajax_object.wp_user_email?"":ajax_object.wp_user_email,user_name:void 0===ajax_object.wp_user_nicename?"":ajax_object.wp_user_nicename,user_memlevel:void 0===ajax_object.wp_user_memlevel?"":ajax_object.wp_user_memlevel};else{if(!t)return;localStorage.getItem("access_token")||g("Login attempted without Access Token"),e={user_avatar:void 0===a["http://makershare.com/picture"]?a.picture:a["http://makershare.com/picture"],user_email:void 0===a.email?"":a.email,user_name:void 0===a["http://makershare.com/first_name"]&&void 0===a["http://makershare.com/last_name"]?"":a["http://makershare.com/first_name"]+" "+a["http://makershare.com/last_name"],user_memlevel:void 0===a["http://makershare.com/membership_level"]?"":a["http://makershare.com/membership_level"]}}var o=e;if(""!=o.user_avatar&&(jQuery("#profile-view #dropdownMenuLink img.avatar").attr("src",o.user_avatar),jQuery("#profile-view .profile-info img.avatar").attr("src",o.user_avatar)),document.querySelector(".profile-email").innerHTML=o.user_email,document.querySelector(".profile-info .profile-name").innerHTML=o.user_name,""!=o.user_memlevel)switch(o.user_memlevel){case"premium":document.querySelector(".avatar-banner").src="https://make.co/wp-content/universal-assets/v2/images/premium-banner.png",document.querySelector(".avatar-banner").setAttribute("alt","Premium Member");break;case"upgrade":document.querySelector(".avatar-banner").src="https://make.co/wp-content/universal-assets/v2/images/upgrade-banner.png",document.querySelector(".avatar-banner").setAttribute("alt","Upgrade Membership")}else jQuery(".avatar-banner").remove();setTimeout(function(){null!==document.querySelector(".avatar-banner")&&(document.querySelector(".avatar-banner").style.display="block")},100),document.querySelector("#LoginBtn").style.display="none",document.querySelector(".dropdown-toggle img").style.display="block",jQuery(".login-section").css("display","block"),jQuery(".profile-menu").addClass("logged-in"),jQuery(".mobile-subscribe-btn").css("display","none"),"upgrade"==e.user_memlevel?jQuery(".dropdown-menu .profile-info").after("<a href='https://make.co/join/' class='btn membership-btn'>Upgrade Membership</a>"):"none"==e.user_memlevel&&jQuery(".dropdown-menu .profile-info").after("<a href='https://make.co/join/' class='btn membership-btn'>Join Now!</a>")}else jQuery("#LoginBtn").css("display","block"),jQuery("#profile-view, #LogoutBtn").css("display","none"),jQuery(".login-section").css("display","block")}function m(){var e,o;void 0!==a&&(a.sub,o=localStorage.getItem("access_token"),e=localStorage.getItem("id_token"),o={action:"mm_wplogin",auth0_userProfile:a,auth0_access_token:o,auth0_id_token:e},jQuery.ajax({type:"POST",url:ajax_object.ajax_url,data:o,timeout:1e4,success:function(e){}}).done(function(){0==r&&(jQuery("#menu-secondary_universal_menu").load(document.URL+" #menu-secondary_universal_menu > *"),jQuery(".main-content").length&&jQuery(".join-box").length&&window.location.replace("/digital-library/"),!jQuery(".main-content").length||jQuery(".blog.tribe-theme-child-make-campus").length||jQuery(".makerspaces").length||jQuery(".post-type-archive-tribe_events ").length||jQuery(".main-content").load(document.URL+" .main-content > *"),jQuery(".page-content").length&&jQuery(".page-content").load(document.URL+" .page-content > *"),jQuery(".logged-in-refresh").length&&jQuery(".logged-in-refresh").load(document.URL+" .logged-in-refresh > *"),jQuery("body").addClass("logged-in"),jQuery(".universal-loading-spinner").remove())}).fail(function(e,o,t){jQuery(".universal-loading-spinner").remove(),"timeout"===o?(alert("Your login has timed out. Please try the login again."),g(a.email+" ran over the timeout limit of 10 seconds. Error was: "+JSON.stringify(t)),location.href=location.href):(alert("I'm sorry. We had an issue logging you into our system. Error Code: 0599.\nPlease contact our support at community@make.co with this error code for assistance."),g(a.email+" had an issue logging in at the WP Login phase. That error is: "+JSON.stringify(e)))}))}function d(){jQuery("#wpadminbar").length&&(jQuery("body").removeClass("adminBar").removeClass("logged-in"),jQuery("#wpadminbar").remove(),jQuery("#mm-preview-settings-bar").remove());jQuery.post(ajax_object.ajax_url,{action:"mm_wplogout"},function(e){window.location.href="https://login.make.co/v2/logout?returnTo="+templateUrl+"&client_id="+AUTH0_CLIENT_ID}).done(function(){l(),location.href=location.href})}function g(e){jQuery.post(ajax_object.ajax_url,{action:"make_error_log",make_error:e},function(e){})}document.body.classList.contains("makehub")?n=i=!0:-1===e.indexOf("mfaire")&&-1===e.indexOf("makerfaire")||(n=!0),i&&(document.body.classList.contains("logged-in")||"true"==getUrlParam("login"))?(r=!0,u()):(o=new auth0.WebAuth({domain:AUTH0_CUSTOM_DOMAIN,clientID:AUTH0_CLIENT_ID,redirectUri:AUTH0_CALLBACK_URL,audience:"https://"+AUTH0_DOMAIN+"/userinfo",responseType:"token id_token",scope:"openid profile email user_metadata",leeway:60}),jQuery("#LogoutBtn").on("click",function(e){l()}),0==n?(jQuery("#LoginBtn").on("click",function(e){e.preventDefault(),setCookie("make_redirect_url",window.location.href,1),o.authorize({clientID:AUTH0_CLIENT_ID,redirect_uri:location.protocol+"//"+location.hostname})}),jQuery("#LogoutBtn").on("click",function(e){e.preventDefault(),o.logout({clientID:AUTH0_CLIENT_ID,returnTo:location.protocol+"//"+location.hostname})})):-1===e.indexOf("mfaire")&&-1===e.indexOf("makerfaire")||jQuery("#LoginBtn").on("click",function(e){setCookie("make_redirect_url",window.location.href,1)}),localStorage.getItem("first_login")?(auth0Hash.includes("access_token")?o.parseHash({hash:auth0Hash},function(e,o){e&&console.log("parse hash err",e),o&&(t=!0,a=o.idTokenPayload,c(o),u(),n)&&0==r&&!jQuery("body").is(".logged-in")&&(jQuery(".universal-footer").before('<img src="https://make.co/wp-content/universal-assets/v2/images/makey-spinner.gif" class="universal-loading-spinner" style="position:absolute;top:50%;left:50%;margin-top:-75px;margin-left:-75px;" />'),m()),window.location.hash=""}):auth0Hash.includes("login_required")&&(n&&jQuery("body").is(".logged-in")&&d(),l()),localStorage.removeItem("first_login")):localStorage.getItem("expires_at")&&localStorage.getItem("expires_at")>Date.now()?o.client.userInfo(localStorage.getItem("access_token"),function(e,o){e&&"https://make.co/wp-content/universal-assets/v2/images/default-makey.png"==jQuery("#profile-view img.avatar").attr("src")&&(console.log("Get User Info Error: ${err}"),s()),a=o,t=!0,u()}):s()),jQuery(".change_password").click(function(){var e;jQuery(".change_password").remove(),jQuery("#responseText").html("Sending Request"),(e=void 0===e?new auth0.WebAuth({domain:AUTH0_CUSTOM_DOMAIN,clientID:AUTH0_CLIENT_ID,redirectUri:AUTH0_CALLBACK_URL,audience:"https://"+AUTH0_DOMAIN+"/userinfo",responseType:"token id_token",scope:"openid profile email user_metadata",leeway:60}):e).changePassword({connection:"DB-Make-Community",email:jQuery("#email").val()},function(e,o){e?console.log(e.message):jQuery("#responseText").html(o)})})});
//# sourceMappingURL=universal-auth0.min.js.map