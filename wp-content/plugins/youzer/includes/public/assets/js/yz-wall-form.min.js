!function(y){"use strict";y(document).ready(function(){y(".yz-wall-post").on("click",function(){var e,l=0,d=y(this),r=y(this).text(),o=d.closest("form#yz-wall-form"),c={};y.each(o.serializeArray(),function(e,t){"_"!==t.name.substr(0,1)&&"whats-new"!==t.name.substr(0,9)&&(c[t.name]?y.isArray(c[t.name])?c[t.name].push(t.value):c[t.name]=new Array(c[t.name],t.value):c[t.name]=t.value)}),o.find("*").each(function(){(y.nodeName(this,"textarea")||y.nodeName(this,"input"))&&y(this).prop("disabled",!0)}),o.find(".yz-wall-textarea").get(0).emojioneArea&&o.find(".yz-wall-textarea").data("emojioneArea").disable(),d.addClass("loading"),d.prop("disabled",!0),o.addClass("submitted"),d.css("min-width",d.css("width")),d.html('<i class="fas fa-spinner fa-spin"></i>');var t="",a=y("#yz-whats-new-post-in").val(),i=y("#whats-new").val(),f=y("#buddypress ul.activity-list li").first(),n=f,s=null;return f.length&&(n.hasClass("load-newest")&&(n=f.next()),s=n.prop("class").match(/date-recorded-([0-9]+)/)),s&&(l=s[1]),0<a&&(t=y("#yz-whats-new-post-object").val()),e=y.extend({action:"yz_post_update",cookie:bp_get_cookies(),_yz_wpnonce_post_update:y("#_yz_wpnonce_post_update").val(),content:i,object:t,item_id:a,since:l,_bp_as_nonce:y("#_bp_as_nonce").val()||""},c),y.post(ajaxurl,e,function(e){if(o.find("*").each(function(){(y.nodeName(this,"textarea")||y.nodeName(this,"input"))&&y(this).prop("disabled",!1)}),o.find(".yz-wall-textarea").get(0).emojioneArea&&o.find(".yz-wall-textarea").data("emojioneArea").enable(),y.yz_isJSON(e)){var t=y.parseJSON(e);y.yz_DialogMsg("error",t.error)}else{if(d.html('<i class="fas fa-check"></i>').hide().fadeIn("slow"),o.find(".yz-delete-attachment").trigger("click"),0===y("ul.activity-list").length&&(y("div.error").slideUp(100).remove(),y("#message").slideUp(100).remove(),y("div.activity").append('<ul id="activity-stream" class="activity-list item-list">')),f.hasClass("load-newest")&&f.remove(),y("#activity-stream").prepend(e),l||y("#activity-stream li:first").addClass("new-update just-posted"),y("body,html").animate({scrollTop:y("#"+y(e).attr("id")).offset().top-65+"px"},1e3),0!==y("#latest-update").length){var a=y("#activity-stream li.new-update .activity-content .activity-inner p").html(),i=y("#activity-stream li.new-update .activity-content .activity-header p a.view").attr("href"),n=y("#activity-stream li.new-update .activity-content .activity-inner p").text(),s="";""!==n&&(s=a+" "),s+='<a href="'+i+'" rel="nofollow">'+BP_DTheme.view+"</a>",y("#latest-update").slideUp(300,function(){y("#latest-update").html(s),y("#latest-update").slideDown(300)})}y("li.new-update").hide().slideDown(300),y("li.new-update").removeClass("new-update"),y("#whats-new").val(""),"activity_slideshow"==c.post_type&&y.youzer_sliders_init(),o.get(0).reset(),o.find(".yz-wall-textarea").get(0).emojioneArea&&o.find(".yz-wall-textarea").get(0).emojioneArea.setText(""),o.find(".yz-tagged-user .yz-tagusers-delete-user, .yz-list-delete-item, .yz-list-close-icon").trigger("click"),o.find("div.yz-activity-privacy").find(".list div").first().trigger("click"),o.find("#yz-whats-new-post-in").next(".nice-select").find(".list div").first().trigger("click"),o.find('.yz-wall-options input:radio[name="post_type"]').first().trigger("change"),o.find(".yz-lp-prepost .lp-button-cancel").trigger("click"),newest_activities="",activity_last_recorded=0}setTimeout(function(){d.html(r).fadeIn("slow")},1e3),o.find(".yz-wall-post,.yz-update-post").prop("disabled",!1).removeClass("loading")}),!1}),y(document).on("change",'input:radio[name="post_type"]',function(){var e=y(this).closest("form"),t=y(this).val(),a=y(this).data("uploader");1<y('input:radio[name="post_type"]').length?0==e.find('.yz-wall-custom-form[data-post-type!="'+t+'"]').length?e.find('.yz-wall-custom-form[data-post-type="'+t+'"]').fadeIn():e.find('.yz-wall-custom-form[data-post-type!="'+t+'"]').fadeOut(1,function(){e.find('.yz-wall-custom-form[data-post-type="'+t+'"]').fadeIn()}):e.find('.yz-wall-custom-form[data-post-type="'+t+'"]').fadeIn(),"on"==a?e.find(".yz-wall-actions .yz-wall-upload-btn").fadeIn():e.find(".yz-wall-actions .yz-wall-upload-btn").fadeOut(),e.find(".yz-attachment-item").remove()}),y('input:radio[name="post_type"]').first().trigger("change");var t=0,a=null;y("#yz-wall-form");y(document).on("click",".yz-wall-upload-btn",function(e){var t=y(this).closest("form");if(!y.yz_CheckFilesNumber(t)||t.find(".yz-file-progress")[0])return!1;y(this).closest("form").find("#yz-upload-attachments").click(),e.preventDefault()}),y(document).on("change","#yz-upload-attachments",function(e){e.preventDefault();var t=y(this).get(0);a=t,y.yz_UploadFiles(y(this).closest("form"),{attachments:t,max_size:Yz_Wall.max_size,max_number:20,allowed_extensions:["png","jpg","jpeg","gif","mp4","ogv","ogg","mp3","wav","webm"]})}),y.yz_validate_attachment=function(e,t,a){var i=y.extend({allowed_extensions:["jpg","jpeg","gif","png"],max_number:3,max_size:3},a);if(t.size>1048576*i.max_size)return y.yz_DialogMsg("error",Yz_Wall.invalid_file_size),!1;if(!y.yz_CheckFilesNumber(e))return!1;if(e.find(".yz-attachment-item").length+1>i.max_number)return y.yz_DialogMsg("error",Yz_Wall.invalid_files_number),!1;var n=t.name.split(".").pop().toLowerCase();if(y.yz_isPostType(e,"activity_video")){var s=Yz_Wall.video_extentions;if(-1==y.inArray(n,s))return y.yz_DialogMsg("error",Yz_Wall.invalid_video_ext),!1}if(y.yz_isPostType(e,"activity_photo")||y.yz_isPostType(e,"activity_slideshow")){var l=Yz_Wall.image_extentions;if(-1==y.inArray(n,l))return y.yz_DialogMsg("error",Yz_Wall.invalid_image_ext),!1}if(y.yz_isPostType(e,"activity_file")){var d=Yz_Wall.file_extentions;if(-1==y.inArray(n,d))return y.yz_DialogMsg("error",Yz_Wall.invalid_file_ext),!1}if(y.yz_isPostType(e,"activity_audio")){var r=Yz_Wall.audio_extentions;if(-1==y.inArray(n,r))return y.yz_DialogMsg("error",Yz_Wall.invalid_audio_ext),!1}return!0},y.yz_UploadFiles=function(e,t){for(var a=y.extend({allowed_extensions:Yz_Wall.default_extentions,max_number:3,max_size:3},t),i=a.attachments.files,n=0;n<i.length;n++){var s=i[n];if(!y.yz_validate_attachment(e,s,a))return!1;var l=y.youzerAttachmentItem({file:s,file_name:s.name});e.find(".yz-form-attachments").append(l),0==n&&y.yz_UploadFile(e,s)}},y.youzerAttachmentItem=function(e){var t,a=y.extend({},e);return t='<div class="yz-attachment-item yz-file-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i><span class="yz-file-name">'+y.yz_GetNameExcerpt(a.file_name)+'</span></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>','<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>',y.yz_CheckIsFileImage(a.file)?'<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>':t},y.yz_UploadFile=function(l,d){var r=l.find(".yz-file-progress:first").parent(".yz-attachment-item"),e=new FormData;e.append("image",d),e.append("action","yz_upload_wall_attachments"),e.append("security",l.find('input[name="_yz_wpnonce_post_update"]').val()),y.ajax({type:"POST",url:Youzer.ajax_url,data:e,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=y.ajaxSettings.xhr();return e.upload&&(l.find(".yz-wall-post,.yz-update-post").attr("disabled",!0),e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.total,a=100*e.loaded/t,i=r.find(".yz-file-upload");r.find(".yz-file-icon").attr("class","fas fa-spinner fa-spin yz-file-icon"),i.css("width",a+"%"),100<=a&&i.addClass("yz-file-uploaded")}})),e},success:function(e){var t=y.parseJSON(e);if(t.error)return y.yz_DialogMsg("error",t.error),r.remove(),y.yz_CheckUploadProgress(l),!1;r.find(".yz-file-progress").fadeOut(400,function(){y(this).remove(),y.yz_upload_next_file(l),y.yz_CheckUploadProgress(l)}),y.yz_CheckIsFileImage(d)&&r.find(".yz-file-icon").remove(),r.find(".yz-file-icon").attr("class","fas fa-paperclip yz-file-icon"),r.find(".yz-attachment-details").append('<i class="fas fa-trash-alt yz-delete-attachment"></i>'),r.find(".yz-attachment-data").val(e);var i=new FileReader;d.type.match("video.*")&&(i.onload=function(){var e=new Blob([i.result],{type:d.type}),n=URL.createObjectURL(e),s=document.createElement("video"),t=function(){a()&&(s.removeEventListener("timeupdate",t),s.pause())};s.addEventListener("loadeddata",function(){a()&&s.removeEventListener("timeupdate",t)});var a=function(){var e=document.createElement("canvas");e.width=s.videoWidth,e.height=s.videoHeight,e.getContext("2d").drawImage(s,0,0,e.width,e.height);var t=e.toDataURL("image/jpeg"),a=1e5<t.length;if(a){var i=JSON.parse(r.find(".yz-attachment-data").val());i[0].video_thumbnail=t,r.find(".yz-attachment-data").val(JSON.stringify(i)),URL.revokeObjectURL(n)}return a};s.addEventListener("timeupdate",t),s.preload="metadata",s.src=n,s.muted=!0,s.playsInline=!0,s.play()},i.readAsArrayBuffer(d));var a=y.parseJSON(e),n=y.map(a,function(e){return e.original}),s=Yz_Wall.base_url+"temp/"+n[0];r.css("background-image","url("+s+")")},error:function(e,t,a){r.remove(),y.yz_DialogMsg("error",t),y.yz_CheckUploadProgress(l),y.yz_upload_next_file(l)}})},y.yz_upload_next_file=function(e){t++,void 0!==a.files[t]&&y.yz_UploadFile(e,a.files[t])},y.yz_GetNameExcerpt=function(e){if(e.length<=25)return e;var t=25-"...".length,a=Math.ceil(t/2),i=Math.floor(t/2);return e.substr(0,a)+"..."+e.substr(e.length-i)},y(document).on("click",".yz-delete-attachment",function(e){var t=y(this).closest("form"),a=y(this).closest(".yz-attachment-item"),i=y.parseJSON(a.find(".yz-attachment-data").val()),n=y.map(i,function(e){return e.original});a.remove(),y.yz_DeleteAttachment(t,n[0])}),y.yz_DeleteAttachment=function(e,t){var a=new FormData;a.append("attachment",t),a.append("action","yz_delete_wall_attachment"),a.append("security",e.find('input[name="_yz_wpnonce_post_update"]').val()),y.ajax({type:"POST",data:a,url:ajaxurl,contentType:!1,processData:!1})},y(document).on("click",".yz-tag-users-tool",function(){var i=y(this).closest("form");if(i.find(".yz-feeling-form").fadeOut(),y(this).hasClass("loaded"))return i.find(".yz-tagusers-form").fadeToggle(),void i.find(".yz-tagusers-search-input").focus();var n=y(this),s=n.find("i"),l=s.attr("class");s.attr("class","fas fa-spinner fa-spin"),y.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"yz_tag_users_get_user_friends"},success:function(e){n.addClass("loaded");var t=y("<div></div>").append(e.data);if("youzer-edit-activity-wrapper"==i.parent().attr("id")){var a=[];i.find('input[name="tagged_users[]"]').each(function(){t.find('.yz-list-item[data-user-id="100"] ').fadeOut(),a.push(y(this).val())}),t.find(".yz-list-item").each(function(e,t){-1!==jQuery.inArray(y(this).attr("data-user-id"),a)&&y(this).find(".yz-wall-tag-user").hide()})}i.find(".yz-tagusers-form").fadeIn(200,function(){s.attr("class",l),i.find(".yz-tagusers-search-input").focus(),i.find(".yz-wall-tagusers-list").html(t)})}})}),y(document).on("keyup",".yz-list-search-input",function(){var e=y(this).closest(".yz-wall-list"),t=this.value.toLowerCase().trim();e.find(".yz-wall-list-items .yz-list-item").show().filter(function(){return-1==y(this).find(".yz-item-title, .yz-item-description").text().toLowerCase().trim().indexOf(t)}).hide()}),y(document).on("click",".yz-user-mood-tool",function(){var t=y(this).closest("form");if(t.find(".yz-tagusers-form").fadeOut(),y(this).hasClass("loaded"))return t.find(".yz-feeling-form").fadeToggle(),void t.find(".yz-feeling-search-input").focus();t.find(".yz-feeling-form").attr("data-placeholder",t.find(".yz-feeling-search-input").attr("placeholder"));var a=y(this),i=a.find("i"),n=i.attr("class");i.attr("class","fas fa-spinner fa-spin"),y.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"yz_feeling_activity_get_categories"},success:function(e){a.addClass("loaded"),t.find(".yz-feeling-form").fadeIn(200,function(){i.attr("class",n),t.find(".yz-feeling-search-input").focus(),t.find(".yz-wall-feeling-list").html(e.data)})}})}),y(document).on("click",".yz-feeling-item",function(e){e.preventDefault();var t=y(this),a=t.closest(".yz-wall-feeling");if(y(this).parent().hasClass("yz-list-category-items"))y.yz_select_mood_emojis(a,t.attr("data-emoji"),t.attr("data-category-title"),t.find(".yz-item-img").css("background-image"));else{a.find(".yz-list-items-title").text(t.attr("data-category-title")),a.find('input[name="mood_type"]').val(t.attr("data-category-title")),a.find(".yz-list-categories").fadeOut(),a.find(".yz-feeling-close-icon").addClass("yz-feeling-go-back"),a.find(".yz-feeling-close-icon i").attr("class","far fa-arrow-alt-circle-left"),a.find('input[name="mood_search"]').val("").attr("placeholder",t.find(".yz-item-description").text()),a.find(".yz-list-search-icon i").attr("class",t.find(".yz-item-icon i").attr("class"));var i=a.find('.yz-list-category-items[data-category="'+y(this).attr("data-category")+'"]');1==i.length?i.fadeIn():a.find(".yz-list-submit-button").fadeIn()}}),y(document).on("click",".yz-feeling-close-icon",function(){var e=y(this),t=e.closest(".yz-wall-feeling");if(t.find(".yz-feeling-submit-button").fadeOut(),t.find(".yz-feeling-search-input").val(""),t.find(".yz-feeling-search-input").attr("placeholder",t.find(".yz-feeling-form").attr("data-placeholder")),t.find(".yz-feeling-search-icon i").attr("class","fas fa-search"),e.hasClass("yz-feeling-go-back"))return e.find("i").attr("class","fas fa-times"),t.find(".yz-list-categories, .yz-list-item").fadeIn(),t.find(".yz-list-category-items").fadeOut(),void e.removeClass("yz-feeling-go-back");e.closest(".yz-feeling-form").fadeOut()}),y(document).on("click",".yz-wall-feeling .yz-list-edit-item",function(){var e=y(this),t=e.closest(".yz-wall-feeling"),a=t.find(".yz-list-selected-items");a.fadeOut(200,function(){t.find(".yz-feeling-search-input").val(a.find(".yz-item-title").text()),e.closest(".yz-selected-item").fadeOut(200,function(){y(this).remove()}),t.find(".yz-feeling-form").fadeIn(),t.removeClass("yz-activity-feeling-selected")})}),y(document).on("click",".yz-wall-feeling .yz-list-delete-item",function(){var e=y(this),t=e.closest(".yz-wall-feeling"),a=t.find(".yz-list-selected-items");a.fadeOut(200,function(){a.find(".yz-item-title").text(""),e.closest(".yz-selected-item").fadeOut(200,function(){y(this).remove()}),t.find(".yz-feeling-close-icon").trigger("click"),t.removeClass("yz-activity-feeling-selected")})}),y(document).on("click",".yz-feeling-submit-button",function(){var e=y(this).closest(".yz-wall-feeling"),t=e.find(".yz-feeling-search-input").val();""!=t.trim()&&y.yz_select_mood_emojis(e,t,t)}),y(document).on("keypress",".yz-feeling-search-input",function(e){if(13==e.keyCode){e.preventDefault();var t=y(this).next(".yz-feeling-submit-button");"none"!=t.css("display")&&t.click()}}),y.yz_select_mood_emojis=function(e,t,a,i){e.hasClass("yz-activity-feeling-selected")&&e.find(".yz-selected-item").remove(),e.addClass("yz-activity-feeling-selected"),e.find(".yz-feeling-form").fadeOut(0,function(){e.find(".yz-feeling-selected-items").fadeIn()});var n=null==i?"":"<div class='yz-item-img' style='background-image: "+i+";'></div>",s=null==i?" yz-selected-item-no-image":"";e.find(".yz-list-selected-items").append('<div class="yz-selected-item yz-feeling-selected-item'+s+'">'+n+'<div class="yz-item-title">'+a+'</div><i class="fas fa-pencil-alt yz-selected-item-tool yz-list-edit-item"></i><i class="fas fa-trash-alt yz-selected-item-tool yz-list-delete-item"></i><input type="hidden" name="mood_value" value="'+t+'"></div>').fadeIn(),e.find(".yz-feeling-search-input").val("")},y(document).on("click",".yz-wall-tag-user",function(){var a=y(this);if(!a.hasClass("yz-selected")){a.addClass("yz-selected");var i=a.closest(".yz-list-item");y(this).fadeOut(200,function(){var e="<div class=\"yz-selected-item yz-tagged-user\"><div class='yz-item-img' style='background-image: "+i.find(".yz-item-img").css("background-image")+';\'></div><div class="yz-item-title">'+i.find(".yz-item-title").text()+'</div><i class="fas fa-trash-alt yz-selected-item-tool yz-list-delete-item yz-tagusers-delete-user" data-user-id="'+i.attr("data-user-id")+'"></i><input type="hidden" name="tagged_users[]" value="'+i.attr("data-user-id")+'"></div>';i.closest(".yz-wall-tagusers").find(".yz-tagged-users").append(e);a.closest(".yz-wall-tagusers").find(".yz-tagged-user").length;var t=a.closest(".yz-wall-tagusers");1==t.find(".yz-tagged-user").length&&t.find(".yz-tagged-users").fadeIn()})}}),y(document).on("click",".yz-list-close-icon.yz-tagusers-close-icon",function(){y(this).closest(".yz-tagusers-form").fadeOut()}),y(document).on("click",".yz-tagusers-delete-user",function(){y(this).parent();var e=y(this).closest(".yz-wall-tagusers"),t=y(this).closest(".yz-tagged-users");e.find(".yz-list-item[data-user-id="+y(this).attr("data-user-id")+"] .yz-wall-tag-user").removeClass("yz-selected").fadeIn(),y(this).parent().fadeOut(200,function(){y(this).remove(),0==t.find(".yz-tagged-user").length&&t.fadeOut()})}),y(document).on("change","#yz-whats-new-post-in",function(e){0!=y(this).val()?y(this).closest(".yz-wall-actions").find("div.yz-activity-privacy").fadeOut():y(this).closest(".yz-wall-actions").find("div.yz-activity-privacy").fadeIn()}),y(document).on("click",".yz-send-comment",function(e){if(e.preventDefault(),!y(this).hasClass("loading")){var i,n,t,a,s,l,d,r,o,c,f=y(this);return f.addClass("loading"),c=f.find("i").attr("class"),f.find("i").attr("class","fas fa-spinner fa-spin"),t=(i=f.parents("form")).parent(),s=i.attr("id").split("-"),a=t.hasClass("activity-comments")?s[2]:t.attr("id").split("-")[1],n=y("#"+i.attr("id")+" textarea"),y("#"+i.attr("id")+" div.error").hide(),f.addClass("loading").prop("disabled",!0),n.addClass("loading").prop("disabled",!0),l={action:"new_activity_comment",cookie:bp_get_cookies(),_wpnonce_new_activity_comment:y("#_wpnonce_new_activity_comment").val(),comment_id:a,form_id:s[2],content:n.val()},(d=y("#_bp_as_nonce_"+a).val())&&(l["_bp_as_nonce_"+a]=d),y.post(ajaxurl,l,function(t){if(f.removeClass("loading"),n.removeClass("loading"),f.find("i").attr("class",c),t[0]+t[1]==="-1")i.append(y(t.substr(2,t.length)).hide().fadeIn(200));else{var a=i.parent();i.fadeOut(200,function(){0===a.children("ul").length&&(a.hasClass("activity-comments")?a.prepend("<ul></ul>"):a.append("<ul></ul>"));var e=y.trim(t);a.children("ul").append(y(e).hide().fadeIn(200)),i.children("textarea").val(""),a.parent().addClass("has-comments")}),y("#"+i.attr("id")+" textarea").val(""),r=Number(y("#activity-"+s[2]+" a.acomment-reply span").html())+1,y("#activity-"+s[2]+" a.acomment-reply span").html(r),(o=a.parents(".activity-comments").find(".show-all a"))&&o.html(BP_DTheme.show_x_comments.replace("%d",r))}y(f).prop("disabled",!1),y(n).prop("disabled",!1)}),!1}}),y(document).on("keypress",".ac-form textarea",function(e){13!=e.which||e.shiftKey||(e.preventDefault(),y(this).closest("form").find(".yz-send-comment").click())}),y.yz_CheckIsFileImage=function(e){var t=e.type;return!(y.inArray(t,["image/gif","image/jpeg","image/png"])<0)},y.yz_CheckUploadProgress=function(e){e.find(".yz-file-progress")[0]||(e.find("#yz-upload-attachments").val(""),e.find('.yz-wall-actions button[type="submit"]').attr("disabled",!1),t=0,a=null)},y.yz_isPostType=function(e,t){return t==e.find('input:radio[name="post_type"]:checked').val()},y.yz_CheckFilesNumber=function(e){return"activity_photo"==e.find('input:radio[name="post_type"]:checked').val()||"activity_slideshow"==e.find('input:radio[name="post_type"]:checked').val()||!e.find(".yz-attachment-item")[0]||(y.yz_DialogMsg("error",Yz_Wall.max_one_file),!1)}})}(jQuery);