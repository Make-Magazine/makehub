!function(f){"use strict";f(document).ready(function(){f(".yz-wall-post").on("click",function(){var e,l=0,r=f(this),o=f(this).text(),d=r.closest("form#yz-wall-form"),c={};f.each(d.serializeArray(),function(e,t){"_"!==t.name.substr(0,1)&&"whats-new"!==t.name.substr(0,9)&&(c[t.name]?f.isArray(c[t.name])?c[t.name].push(t.value):c[t.name]=new Array(c[t.name],t.value):c[t.name]=t.value)}),d.find("*").each(function(){(f.nodeName(this,"textarea")||f.nodeName(this,"input"))&&f(this).prop("disabled",!0)}),d.find(".yz-wall-textarea").get(0).emojioneArea&&d.find(".yz-wall-textarea").data("emojioneArea").disable(),r.addClass("loading"),r.prop("disabled",!0),d.addClass("submitted"),r.css("min-width",r.css("width")),r.html('<i class="fas fa-spinner fa-spin"></i>');var t="",a=f("#yz-whats-new-post-in").val(),i=f("#whats-new").val(),p=f("#buddypress ul.activity-list li").first(),n=p,s=null;return p.length&&(n.hasClass("load-newest")&&(n=p.next()),s=n.prop("class").match(/date-recorded-([0-9]+)/)),s&&(l=s[1]),0<a&&(t=f("#yz-whats-new-post-object").val()),e=f.extend({action:"yz_post_update",cookie:bp_get_cookies(),_yz_wpnonce_post_update:f("#_yz_wpnonce_post_update").val(),content:i,object:t,item_id:a,since:l,_bp_as_nonce:f("#_bp_as_nonce").val()||""},c),f.post(ajaxurl,e,function(e){if(d.find("*").each(function(){(f.nodeName(this,"textarea")||f.nodeName(this,"input"))&&f(this).prop("disabled",!1)}),d.find(".yz-wall-textarea").get(0).emojioneArea&&d.find(".yz-wall-textarea").data("emojioneArea").enable(),f.yz_isJSON(e)){var t=f.parseJSON(e);f.yz_DialogMsg("error",t.error)}else{if(r.html('<i class="fas fa-check"></i>').hide().fadeIn("slow"),d.find(".yz-delete-attachment").trigger("click"),0===f("ul.activity-list").length&&(f("div.error").slideUp(100).remove(),f("#message").slideUp(100).remove(),f("div.activity").append('<ul id="activity-stream" class="activity-list item-list">')),p.hasClass("load-newest")&&p.remove(),f("#activity-stream").prepend(e),l||f("#activity-stream li:first").addClass("new-update just-posted"),f("body,html").animate({scrollTop:f("#"+f(e).attr("id")).offset().top-65+"px"},1e3),0!==f("#latest-update").length){var a=f("#activity-stream li.new-update .activity-content .activity-inner p").html(),i=f("#activity-stream li.new-update .activity-content .activity-header p a.view").attr("href"),n=f("#activity-stream li.new-update .activity-content .activity-inner p").text(),s="";""!==n&&(s=a+" "),s+='<a href="'+i+'" rel="nofollow">'+BP_DTheme.view+"</a>",f("#latest-update").slideUp(300,function(){f("#latest-update").html(s),f("#latest-update").slideDown(300)})}f("li.new-update").hide().slideDown(300),f("li.new-update").removeClass("new-update"),f("#whats-new").val(""),"activity_slideshow"==c.post_type&&f.youzer_sliders_init(),d.get(0).reset(),d.find(".yz-wall-textarea").get(0).emojioneArea&&d.find(".yz-wall-textarea").get(0).emojioneArea.setText(""),d.find('.yz-wall-options input:radio[name="post_type"]').first().trigger("change"),d.find(".yz-lp-prepost .lp-button-cancel").trigger("click"),newest_activities="",activity_last_recorded=0}setTimeout(function(){r.html(o).fadeIn("slow")},1e3),d.find(".yz-wall-post,.yz-update-post").prop("disabled",!1).removeClass("loading")}),!1}),f(document).on("change",'input:radio[name="post_type"]',function(){var e=f(this).closest("form"),t=f(this).val(),a=f(this).data("uploader");1<f('input:radio[name="post_type"]').length?0==e.find('.yz-wall-custom-form[data-post-type!="'+t+'"]').length?e.find('.yz-wall-custom-form[data-post-type="'+t+'"]').fadeIn():e.find('.yz-wall-custom-form[data-post-type!="'+t+'"]').fadeOut(1,function(){e.find('.yz-wall-custom-form[data-post-type="'+t+'"]').fadeIn()}):e.find('.yz-wall-custom-form[data-post-type="'+t+'"]').fadeIn(),"on"==a?e.find(".yz-wall-actions .yz-wall-upload-btn").fadeIn():e.find(".yz-wall-actions .yz-wall-upload-btn").fadeOut(),e.find(".yz-attachment-item").remove()}),f('input:radio[name="post_type"]').first().trigger("change");var t=0,a=null;f("#yz-wall-form");f(document).on("click",".yz-wall-upload-btn",function(e){var t=f(this).closest("form");if(!f.yz_CheckFilesNumber(t)||t.find(".yz-file-progress")[0])return!1;f(this).closest("form").find("#yz-upload-attachments").click(),e.preventDefault()}),f(document).on("change","#yz-upload-attachments",function(e){e.preventDefault();var t=f(this).get(0);a=t,f.yz_UploadFiles(f(this).closest("form"),{attachments:t,max_size:Yz_Wall.max_size,max_number:20,allowed_extensions:["png","jpg","jpeg","gif","mp4","ogv","ogg","mp3","wav","webm"]})}),f.yz_validate_attachment=function(e,t,a){var i=f.extend({allowed_extensions:["jpg","jpeg","gif","png"],max_number:3,max_size:3},a);if(t.size>1048576*i.max_size)return f.yz_DialogMsg("error",Yz_Wall.invalid_file_size),!1;if(!f.yz_CheckFilesNumber(e))return!1;if(e.find(".yz-attachment-item").length+1>i.max_number)return f.yz_DialogMsg("error",Yz_Wall.invalid_files_number),!1;var n=t.name.split(".").pop().toLowerCase();if(f.yz_isPostType(e,"activity_video")){var s=Yz_Wall.video_extentions;if(-1==f.inArray(n,s))return f.yz_DialogMsg("error",Yz_Wall.invalid_video_ext),!1}if(f.yz_isPostType(e,"activity_photo")||f.yz_isPostType(e,"activity_slideshow")){var l=Yz_Wall.image_extentions;if(-1==f.inArray(n,l))return f.yz_DialogMsg("error",Yz_Wall.invalid_image_ext),!1}if(f.yz_isPostType(e,"activity_file")){var r=Yz_Wall.file_extentions;if(-1==f.inArray(n,r))return f.yz_DialogMsg("error",Yz_Wall.invalid_file_ext),!1}if(f.yz_isPostType(e,"activity_audio")){var o=Yz_Wall.audio_extentions;if(-1==f.inArray(n,o))return f.yz_DialogMsg("error",Yz_Wall.invalid_audio_ext),!1}return!0},f.yz_UploadFiles=function(e,t){for(var a=f.extend({allowed_extensions:Yz_Wall.default_extentions,max_number:3,max_size:3},t),i=a.attachments.files,n=0;n<i.length;n++){var s=i[n];if(!f.yz_validate_attachment(e,s,a))return!1;var l=f.youzerAttachmentItem({file:s,file_name:s.name});e.find(".yz-form-attachments").append(l),0==n&&f.yz_UploadFile(e,s)}},f.youzerAttachmentItem=function(e){var t,a=f.extend({},e);return t='<div class="yz-attachment-item yz-file-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i><span class="yz-file-name">'+f.yz_GetNameExcerpt(a.file_name)+'</span></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>','<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>',f.yz_CheckIsFileImage(a.file)?'<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>':t},f.yz_UploadFile=function(l,r){var o=l.find(".yz-file-progress:first").parent(".yz-attachment-item"),e=new FormData;e.append("image",r),e.append("action","yz_upload_wall_attachments"),e.append("security",l.find('input[name="_yz_wpnonce_post_update"]').val()),f.ajax({type:"POST",url:Youzer.ajax_url,data:e,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=f.ajaxSettings.xhr();return e.upload&&(l.find(".yz-wall-post,.yz-update-post").attr("disabled",!0),e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.total,a=100*e.loaded/t,i=o.find(".yz-file-upload");o.find(".yz-file-icon").attr("class","fas fa-spinner fa-spin yz-file-icon"),i.css("width",a+"%"),100<=a&&i.addClass("yz-file-uploaded")}})),e},success:function(e){var t=f.parseJSON(e);if(t.error)return f.yz_DialogMsg("error",t.error),o.remove(),f.yz_CheckUploadProgress(l),!1;o.find(".yz-file-progress").fadeOut(400,function(){f(this).remove(),f.yz_upload_next_file(l),f.yz_CheckUploadProgress(l)}),f.yz_CheckIsFileImage(r)&&o.find(".yz-file-icon").remove(),o.find(".yz-file-icon").attr("class","fas fa-paperclip yz-file-icon"),o.find(".yz-attachment-details").append('<i class="fas fa-trash-alt yz-delete-attachment"></i>'),o.find(".yz-attachment-data").val(e);var i=new FileReader;r.type.match("video.*")&&(i.onload=function(){var e=new Blob([i.result],{type:r.type}),n=URL.createObjectURL(e),s=document.createElement("video"),t=function(){a()&&(s.removeEventListener("timeupdate",t),s.pause())};s.addEventListener("loadeddata",function(){a()&&s.removeEventListener("timeupdate",t)});var a=function(){var e=document.createElement("canvas");e.width=s.videoWidth,e.height=s.videoHeight,e.getContext("2d").drawImage(s,0,0,e.width,e.height);var t=e.toDataURL("image/jpeg"),a=1e5<t.length;if(a){var i=JSON.parse(o.find(".yz-attachment-data").val());i[0].video_thumbnail=t,o.find(".yz-attachment-data").val(JSON.stringify(i)),URL.revokeObjectURL(n)}return a};s.addEventListener("timeupdate",t),s.preload="metadata",s.src=n,s.muted=!0,s.playsInline=!0,s.play()},i.readAsArrayBuffer(r));var a=f.parseJSON(e),n=f.map(a,function(e){return e.original}),s=Yz_Wall.base_url+"temp/"+n[0];o.css("background-image","url("+s+")")},error:function(e,t,a){o.remove(),f.yz_DialogMsg("error",t),f.yz_CheckUploadProgress(l),f.yz_upload_next_file(l)}})},f.yz_upload_next_file=function(e){t++,void 0!==a.files[t]&&f.yz_UploadFile(e,a.files[t])},f.yz_GetNameExcerpt=function(e){if(e.length<=25)return e;var t=25-"...".length,a=Math.ceil(t/2),i=Math.floor(t/2);return e.substr(0,a)+"..."+e.substr(e.length-i)},f(document).on("click",".yz-delete-attachment",function(e){var t=f(this).closest("form"),a=f(this).closest(".yz-attachment-item"),i=f.parseJSON(a.find(".yz-attachment-data").val()),n=f.map(i,function(e){return e.original});a.remove(),f.yz_DeleteAttachment(t,n[0])}),f.yz_DeleteAttachment=function(e,t){var a=new FormData;a.append("attachment",t),a.append("action","yz_delete_wall_attachment"),a.append("security",e.find('input[name="_yz_wpnonce_post_update"]').val()),f.ajax({type:"POST",data:a,url:ajaxurl,contentType:!1,processData:!1})},f.yz_CheckIsFileImage=function(e){var t=e.type;return!(f.inArray(t,["image/gif","image/jpeg","image/png"])<0)},f.yz_CheckUploadProgress=function(e){e.find(".yz-file-progress")[0]||(e.find("#yz-upload-attachments").val(""),e.find('.yz-wall-actions button[type="submit"]').attr("disabled",!1),t=0,a=null)},f.yz_isPostType=function(e,t){return t==e.find('input:radio[name="post_type"]:checked').val()},f.yz_CheckFilesNumber=function(e){return"activity_photo"==e.find('input:radio[name="post_type"]:checked').val()||"activity_slideshow"==e.find('input:radio[name="post_type"]:checked').val()||!e.find(".yz-attachment-item")[0]||(f.yz_DialogMsg("error",Yz_Wall.max_one_file),!1)}})}(jQuery);