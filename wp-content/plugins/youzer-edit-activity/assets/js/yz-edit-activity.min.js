!function(r){"use strict";r(document).ready(function(){var l;r(document).on("click",".yz-edit-activity",function(t){if(t.preventDefault(),!r(".yz-edit-activity.loading")[0]){var a=r(this),n=a.data("activity-type");if(!a.hasClass("loading")){a.addClass("loading"),l=a,r("#youzer-edit-activity-wrapper");var e={action:"yz_get_edit_activity_form",yz_edit_activity_nonce:Youzer.security_nonce,activity_id:a.data("activity-id"),activity_type:n};r.post(Youzer.ajax_url,e,function(t){if((t=r.parseJSON(t)).remove_button)return l.remove(),void r.yz_DialogMsg("error",t.error);a.attr("data-loaded","true"),a.removeClass("loading");var i=r(t.form);if(t.privacy&&i.find('select.yz-activity-privacy option[value="'+t.privacy+'"]').attr("selected",!0),t.tagged_friends&&(console.log(t.tagged_friends),i.find(".yz-tagged-users").append(t.tagged_friends),0!=i.find(".yz-tagged-user").length&&i.find(".yz-tagged-users").fadeIn()),t.mood&&(i.find(".yz-feeling-title").text(t.mood.title),i.find('input[name="mood_type"]').val(t.mood.type),i.find(".yz-feeling-selected-items").append(t.mood.content).fadeIn(),i.find(".yz-wall-feeling").addClass("yz-activity-feeling-selected")),jQuery.isFunction(r.fn.niceSelect)&&i.find('select:not([multiple="multiple"])').niceSelect(),r("body").append(i),i.find("form").attr("action",""),i.find('input[name="post_type"]')[0]||i.find(".yz-wall-options").append('<input type="hidden" value="'+n+'" name="post_type" />'),i.find('input:radio[name="post_type"]').first().trigger("change"),i.find("#whats-new-post-in-box").remove(),i.find(".yz-wall-options").hide(),i.find(".yz-wall-attchments")[0]&&i.find(".yz-wall-actions").detach().insertAfter(i.find(".yz-wall-attchments")),"activity_giphy"==n&&t.meta.giphy_image&&i.find(".yz-wall-giphy-form .yz-wall-cf-item").hide(1,function(){i.find(".yz-selected-giphy-item").show(1).css("display","inline-block").prepend('<img  src="'+t.meta.giphy_image+'" alt="">'),i.find('.yz-selected-giphy-item input[name="giphy_image"]').val(t.meta.giphy_image)}),i.find('textarea[name="status"]').val(t.content),"undefined"!=typeof Yz_Emoji&&("activity_comment"==n&&"on"==Yz_Emoji.comments_visibility||"activity_comment"!=n&&"on"==Yz_Emoji.posts_visibility)&&(r.yz_init_wall_textarea_emojionearea(i.find(".yz-wall-textarea")),i.find(".emojionearea-editor").html(t.content)),i.find(".yz-wall-post").attr({class:"yz-update-post","data-activity-type":a.data("activity-type"),"data-activity-id":a.data("activity-id")}).text(Youzer.save_changes),r.each(t.meta,function(t,e){i.find('.yz-wall-cf-input[name="'+t+'"]').val(e)}),"hide"==t.attachments?i.find(".yz-wall-upload-btn").remove():i.find(".yz-form-attachments").html(t.attachments),t.url_preview){var e=i.find(".yz-lp-prepost");e.attr("data-loaded",!0),r.yz_set_live_preview_form(e,t.url_preview)}i.css({position:"absolute",top:r(document).scrollTop()+100}),r(".yz-modal-overlay")[0]?r(".yz-modal-overlay").fadeIn():r("body").append('<div class="yz-modal-overlay"></div>')}).fail(function(t,e,i){return a.removeClass("loading"),r.yz_DialogMsg("error",Youzer.unknown_error),!1})}}}),r(document).on("click",".yz-update-post",function(t){t.preventDefault();r(this).attr("data-activity-type");var i=r(this),a=r(this).text(),e=r(this).closest("#yz-wall-form"),n=l.parent().hasClass("activity-meta")?"activity":"comment",o={};if(!i.hasClass("loading")){i.addClass("loading"),i.html('<i class="fas fa-spinner fa-spin"></i>'),jQuery.each(e.serializeArray(),function(t,e){"_"!==e.name.substr(0,1)&&"whats-new"!==e.name.substr(0,9)&&(o[e.name]?jQuery.isArray(o[e.name])?o[e.name].push(e.value):o[e.name]=new Array(o[e.name],e.value):o[e.name]=e.value)});var d=r.extend({action:"yz_save_activity_edit_form",yz_edit_activity_nonce:e.find('input[name="yz_edit_activity_nonce"]').val(),activity_id:r(this).data("activity-id"),content:e.find(".yz-wall-textarea").val(),target:n},o);r.ajax({type:"POST",url:ajaxurl,data:d,success:function(t){if(r.yz_isJSON(t)){var e=r.parseJSON(t);if(e.error)return i.removeClass("loading"),i.text(a),e.remove_modal&&(r.yzea_hide_modal(i),l.remove()),void r.yz_DialogMsg("error",e.error)}"comment"==n&&e.content&&r("li#acomment-"+d.activity_id).find(".acomment-content").first().html("<p>"+e.content+"</p>").show(),"activity"==n&&(r("li#activity-"+d.activity_id).replaceWith(t),r("li#activity-"+d.activity_id).hasClass("activity_slideshow")&&r.youzer_sliders_init()),r.yzea_hide_modal(i)}})}}),r(document).on("click","#yz-edit-activity-form .yz-delete-attachment",function(t){var e=r(this).closest(".yz-attachment-item").attr("data-item-id");e&&r(document).find("#yz-edit-activity-form .yz-wall-attachments").append('<input type="hidden" name="delete_attachments[]" value="'+e+'" >')}),r.yzea_hide_modal=function(t){r(".yz-modal-overlay").fadeOut(300,function(){t.closest(".yz-modal").fadeOut(300,function(){r(this).remove()})})}})}(jQuery);